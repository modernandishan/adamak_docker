/*! choices.js v11.0.2 | Â© 2024 Josh Johnson | https://github.com/jshjohnson/Choices#readme */
var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}"function"==typeof SuppressedError&&SuppressedError;var ActionType={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},EventType={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},ObjectsInConfig=["fuseOptions","classNames"],PassedElementTypes={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},addChoice=function(choice){return{type:ActionType.ADD_CHOICE,choice:choice}},removeChoice=function(choice){return{type:ActionType.REMOVE_CHOICE,choice:choice}},filterChoices=function(results){return{type:ActionType.FILTER_CHOICES,results:results}},activateChoices=function(active){return{type:ActionType.ACTIVATE_CHOICES,active:active}},addGroup=function(group){return{type:ActionType.ADD_GROUP,group:group}},addItem=function(item){return{type:ActionType.ADD_ITEM,item:item}},removeItem$1=function(item){return{type:ActionType.REMOVE_ITEM,item:item}},highlightItem=function(item,highlighted){return{type:ActionType.HIGHLIGHT_ITEM,item:item,highlighted:highlighted}},getRandomNumber=function(min,max){return Math.floor(Math.random()*(max-min)+min)},generateChars=function(length){return Array.from({length:length},(function(){return getRandomNumber(0,36).toString(36)})).join("")},generateId=function(element,prefix){var id=element.id||element.name&&"".concat(element.name,"-").concat(generateChars(2))||generateChars(4);return id=id.replace(/(:|\.|\[|\]|,)/g,""),id="".concat(prefix,"-").concat(id)},getAdjacentEl=function(startEl,selector,direction){void 0===direction&&(direction=1);for(var prop="".concat(direction>0?"next":"previous","ElementSibling"),sibling=startEl[prop];sibling;){if(sibling.matches(selector))return sibling;sibling=sibling[prop]}return null},isScrolledIntoView=function(element,parent,direction){return void 0===direction&&(direction=1),direction>0?parent.scrollTop+parent.offsetHeight>=element.offsetTop+element.offsetHeight:element.offsetTop>=parent.scrollTop},sanitise=function(value){if("string"!=typeof value){if(null==value)return"";if("object"==typeof value){if("raw"in value)return sanitise(value.raw);if("trusted"in value)return value.trusted}return value}return value.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},strToEl=function(){var tmpEl=document.createElement("div");return function(str){tmpEl.innerHTML=str.trim();for(var firstChild=tmpEl.children[0];tmpEl.firstChild;)tmpEl.removeChild(tmpEl.firstChild);return firstChild}}(),resolveNoticeFunction=function(fn,value){return"function"==typeof fn?fn(sanitise(value),value):fn},resolveStringFunction=function(fn){return"function"==typeof fn?fn():fn},unwrapStringForRaw=function(s){if("string"==typeof s)return s;if("object"==typeof s){if("trusted"in s)return s.trusted;if("raw"in s)return s.raw}return""},unwrapStringForEscaped=function(s){if("string"==typeof s)return s;if("object"==typeof s){if("escaped"in s)return s.escaped;if("trusted"in s)return s.trusted}return""},escapeForTemplate=function(allowHTML,s){return allowHTML?unwrapStringForEscaped(s):sanitise(s)},setElementHtml=function(el,allowHtml,html){el.innerHTML=escapeForTemplate(allowHtml,html)},sortByAlpha=function(_a,_b){var value=_a.value,_c=_a.label,label=void 0===_c?value:_c,value2=_b.value,_d=_b.label,label2=void 0===_d?value2:_d;return unwrapStringForRaw(label).localeCompare(unwrapStringForRaw(label2),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},sortByRank=function(a,b){return a.rank-b.rank},dispatchEvent=function(element,type,customArgs){void 0===customArgs&&(customArgs=null);var event=new CustomEvent(type,{detail:customArgs,bubbles:!0,cancelable:!0});return element.dispatchEvent(event)},diff=function(a,b){var aKeys=Object.keys(a).sort(),bKeys=Object.keys(b).sort();return aKeys.filter((function(i){return bKeys.indexOf(i)<0}))},getClassNames=function(ClassNames){return Array.isArray(ClassNames)?ClassNames:[ClassNames]},getClassNamesSelector=function(option){return option&&Array.isArray(option)?option.map((function(item){return".".concat(item)})).join(""):".".concat(option)},addClassesToElement=function(element,className){var _a;(_a=element.classList).add.apply(_a,getClassNames(className))},removeClassesFromElement=function(element,className){var _a;(_a=element.classList).remove.apply(_a,getClassNames(className))},parseCustomProperties=function(customProperties){if(void 0!==customProperties)try{return JSON.parse(customProperties)}catch(e){return customProperties}return{}},updateClassList=function(item,add,remove){var itemEl=item.itemEl;itemEl&&(removeClassesFromElement(itemEl,remove),addClassesToElement(itemEl,add))},Dropdown=function(){function Dropdown(_a){var element=_a.element,type=_a.type,classNames=_a.classNames;this.element=element,this.classNames=classNames,this.type=type,this.isActive=!1}return Dropdown.prototype.show=function(){return addClassesToElement(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},Dropdown.prototype.hide=function(){return removeClassesFromElement(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},Dropdown}(),Container=function(){function Container(_a){var element=_a.element,type=_a.type,classNames=_a.classNames,position=_a.position;this.element=element,this.classNames=classNames,this.type=type,this.position=position,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return Container.prototype.shouldFlip=function(dropdownPos,dropdownHeight){var shouldFlip=!1;return"auto"===this.position?shouldFlip=this.element.getBoundingClientRect().top-dropdownHeight>=0&&!window.matchMedia("(min-height: ".concat(dropdownPos+1,"px)")).matches:"top"===this.position&&(shouldFlip=!0),shouldFlip},Container.prototype.setActiveDescendant=function(activeDescendantID){this.element.setAttribute("aria-activedescendant",activeDescendantID)},Container.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},Container.prototype.open=function(dropdownPos,dropdownHeight){addClassesToElement(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(dropdownPos,dropdownHeight)&&(addClassesToElement(this.element,this.classNames.flippedState),this.isFlipped=!0)},Container.prototype.close=function(){removeClassesFromElement(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(removeClassesFromElement(this.element,this.classNames.flippedState),this.isFlipped=!1)},Container.prototype.addFocusState=function(){addClassesToElement(this.element,this.classNames.focusState)},Container.prototype.removeFocusState=function(){removeClassesFromElement(this.element,this.classNames.focusState)},Container.prototype.enable=function(){removeClassesFromElement(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===PassedElementTypes.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},Container.prototype.disable=function(){addClassesToElement(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===PassedElementTypes.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},Container.prototype.wrap=function(element){var el=this.element,parentNode=element.parentNode;parentNode&&(element.nextSibling?parentNode.insertBefore(el,element.nextSibling):parentNode.appendChild(el)),el.appendChild(element)},Container.prototype.unwrap=function(element){var el=this.element,parentNode=el.parentNode;parentNode&&(parentNode.insertBefore(element,el),parentNode.removeChild(el))},Container.prototype.addLoadingState=function(){addClassesToElement(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},Container.prototype.removeLoadingState=function(){removeClassesFromElement(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},Container}(),Input=function(){function Input(_a){var element=_a.element,type=_a.type,classNames=_a.classNames,preventPaste=_a.preventPaste;this.element=element,this.type=type,this.classNames=classNames,this.preventPaste=preventPaste,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=element.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(Input.prototype,"placeholder",{set:function(placeholder){this.element.placeholder=placeholder},enumerable:!1,configurable:!0}),Object.defineProperty(Input.prototype,"value",{get:function(){return this.element.value},set:function(value){this.element.value=value},enumerable:!1,configurable:!0}),Input.prototype.addEventListeners=function(){var el=this.element;el.addEventListener("paste",this._onPaste),el.addEventListener("input",this._onInput,{passive:!0}),el.addEventListener("focus",this._onFocus,{passive:!0}),el.addEventListener("blur",this._onBlur,{passive:!0})},Input.prototype.removeEventListeners=function(){var el=this.element;el.removeEventListener("input",this._onInput),el.removeEventListener("paste",this._onPaste),el.removeEventListener("focus",this._onFocus),el.removeEventListener("blur",this._onBlur)},Input.prototype.enable=function(){this.element.removeAttribute("disabled"),this.isDisabled=!1},Input.prototype.disable=function(){this.element.setAttribute("disabled",""),this.isDisabled=!0},Input.prototype.focus=function(){this.isFocussed||this.element.focus()},Input.prototype.blur=function(){this.isFocussed&&this.element.blur()},Input.prototype.clear=function(setWidth){return void 0===setWidth&&(setWidth=!0),this.element.value="",setWidth&&this.setWidth(),this},Input.prototype.setWidth=function(){var element=this.element;element.style.minWidth="".concat(element.placeholder.length+1,"ch"),element.style.width="".concat(element.value.length+1,"ch")},Input.prototype.setActiveDescendant=function(activeDescendantID){this.element.setAttribute("aria-activedescendant",activeDescendantID)},Input.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},Input.prototype._onInput=function(){this.type!==PassedElementTypes.SelectOne&&this.setWidth()},Input.prototype._onPaste=function(event){this.preventPaste&&event.preventDefault()},Input.prototype._onFocus=function(){this.isFocussed=!0},Input.prototype._onBlur=function(){this.isFocussed=!1},Input}(),SCROLLING_SPEED=4,List=function(){function List(_a){var element=_a.element;this.element=element,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return List.prototype.prepend=function(node){var child=this.element.firstElementChild;child?this.element.insertBefore(node,child):this.element.append(node)},List.prototype.scrollToTop=function(){this.element.scrollTop=0},List.prototype.scrollToChildElement=function(element,direction){var _this=this;if(element){var listHeight=this.element.offsetHeight,listScrollPosition=this.element.scrollTop+listHeight,elementHeight=element.offsetHeight,elementPos=element.offsetTop+elementHeight,destination=direction>0?this.element.scrollTop+elementPos-listScrollPosition:element.offsetTop;requestAnimationFrame((function(){_this._animateScroll(destination,direction)}))}},List.prototype._scrollDown=function(scrollPos,strength,destination){var easing=(destination-scrollPos)/strength,distance=easing>1?easing:1;this.element.scrollTop=scrollPos+distance},List.prototype._scrollUp=function(scrollPos,strength,destination){var easing=(scrollPos-destination)/strength,distance=easing>1?easing:1;this.element.scrollTop=scrollPos-distance},List.prototype._animateScroll=function(destination,direction){var _this=this,strength=SCROLLING_SPEED,choiceListScrollTop=this.element.scrollTop,continueAnimation=!1;direction>0?(this._scrollDown(choiceListScrollTop,strength,destination),choiceListScrollTop<destination&&(continueAnimation=!0)):(this._scrollUp(choiceListScrollTop,strength,destination),choiceListScrollTop>destination&&(continueAnimation=!0)),continueAnimation&&requestAnimationFrame((function(){_this._animateScroll(destination,direction)}))},List}(),WrappedElement=function(){function WrappedElement(_a){var element=_a.element,classNames=_a.classNames;this.element=element,this.classNames=classNames,this.isDisabled=!1}return Object.defineProperty(WrappedElement.prototype,"isActive",{get:function(){return"active"===this.element.dataset.choice},enumerable:!1,configurable:!0}),Object.defineProperty(WrappedElement.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(WrappedElement.prototype,"value",{get:function(){return this.element.value},set:function(value){this.element.setAttribute("value",value),this.element.value=value},enumerable:!1,configurable:!0}),WrappedElement.prototype.conceal=function(){var el=this.element;addClassesToElement(el,this.classNames.input),el.hidden=!0,el.tabIndex=-1;var origStyle=el.getAttribute("style");origStyle&&el.setAttribute("data-choice-orig-style",origStyle),el.setAttribute("data-choice","active")},WrappedElement.prototype.reveal=function(){var el=this.element;removeClassesFromElement(el,this.classNames.input),el.hidden=!1,el.removeAttribute("tabindex");var origStyle=el.getAttribute("data-choice-orig-style");origStyle?(el.removeAttribute("data-choice-orig-style"),el.setAttribute("style",origStyle)):el.removeAttribute("style"),el.removeAttribute("data-choice")},WrappedElement.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},WrappedElement.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},WrappedElement.prototype.triggerEvent=function(eventType,data){dispatchEvent(this.element,eventType,data||{})},WrappedElement}(),WrappedInput=function(_super){function WrappedInput(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(WrappedInput,_super),WrappedInput}(WrappedElement),coerceBool=function(arg,defaultValue){return void 0===defaultValue&&(defaultValue=!0),void 0===arg?defaultValue:!!arg},stringToHtmlClass=function(input){if("string"==typeof input&&(input=input.split(" ").filter((function(s){return s.length}))),Array.isArray(input)&&input.length)return input},mapInputToChoice=function(value,allowGroup){if("string"==typeof value)return mapInputToChoice({value:value,label:value},!1);var groupOrChoice=value;if("choices"in groupOrChoice){if(!allowGroup)throw new TypeError("optGroup is not allowed");var group=groupOrChoice,choices=group.choices.map((function(e){return mapInputToChoice(e,!1)}));return{id:0,label:unwrapStringForRaw(group.label)||group.value,active:!!choices.length,disabled:!!group.disabled,choices:choices}}var choice=groupOrChoice;return{id:0,group:null,score:0,rank:0,value:choice.value,label:choice.label||choice.value,active:coerceBool(choice.active),selected:coerceBool(choice.selected,!1),disabled:coerceBool(choice.disabled,!1),placeholder:coerceBool(choice.placeholder,!1),highlighted:!1,labelClass:stringToHtmlClass(choice.labelClass),labelDescription:choice.labelDescription,customProperties:choice.customProperties}},isHtmlInputElement=function(e){return"INPUT"===e.tagName},isHtmlSelectElement=function(e){return"SELECT"===e.tagName},isHtmlOption=function(e){return"OPTION"===e.tagName},isHtmlOptgroup=function(e){return"OPTGROUP"===e.tagName},WrappedSelect=function(_super){function WrappedSelect(_a){var element=_a.element,classNames=_a.classNames,template=_a.template,extractPlaceholder=_a.extractPlaceholder,_this=_super.call(this,{element:element,classNames:classNames})||this;return _this.template=template,_this.extractPlaceholder=extractPlaceholder,_this}return __extends(WrappedSelect,_super),Object.defineProperty(WrappedSelect.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),WrappedSelect.prototype.addOptions=function(choices){var _this=this,fragment=document.createDocumentFragment();choices.forEach((function(obj){var choice=obj;if(!choice.element){var option=_this.template(choice);fragment.appendChild(option),choice.element=option}})),this.element.appendChild(fragment)},WrappedSelect.prototype.optionsAsChoices=function(){var _this=this,choices=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach((function(e){isHtmlOption(e)?choices.push(_this._optionToChoice(e)):isHtmlOptgroup(e)&&choices.push(_this._optgroupToChoice(e))})),choices},WrappedSelect.prototype._optionToChoice=function(option){return!option.hasAttribute("value")&&option.hasAttribute("placeholder")&&(option.setAttribute("value",""),option.value=""),{id:0,group:null,score:0,rank:0,value:option.value,label:option.innerHTML,element:option,active:!0,selected:this.extractPlaceholder?option.selected:option.hasAttribute("selected"),disabled:option.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!option.value||option.hasAttribute("placeholder")),labelClass:void 0!==option.dataset.labelClass?stringToHtmlClass(option.dataset.labelClass):void 0,labelDescription:void 0!==option.dataset.labelDescription?option.dataset.labelDescription:void 0,customProperties:parseCustomProperties(option.dataset.customProperties)}},WrappedSelect.prototype._optgroupToChoice=function(optgroup){var _this=this,options=optgroup.querySelectorAll("option"),choices=Array.from(options).map((function(option){return _this._optionToChoice(option)}));return{id:0,label:optgroup.label||"",element:optgroup,active:!!choices.length,disabled:optgroup.disabled,choices:choices}},WrappedSelect}(WrappedElement),DEFAULT_CLASSNAMES={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},DEFAULT_CONFIG={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(value){return!!value&&""!==value},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:sortByAlpha,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(value){return'Press Enter to add <b> "'.concat(value,'" </b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(value){return"Remove item: ".concat(value)},maxItemText:function(maxItemCount){return"Only ".concat(maxItemCount," values can be added")},valueComparer:function(value1,value2){return value1===value2},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:DEFAULT_CLASSNAMES,appendGroupInSearch:!1},removeItem=function(item){var itemEl=item.itemEl;itemEl&&(itemEl.remove(),item.itemEl=void 0)};function items(s,action,context){var state=s,update=!0;switch(action.type){case ActionType.ADD_ITEM:action.item.selected=!0,(el=action.item.element)&&(el.selected=!0,el.setAttribute("selected","")),state.push(action.item);break;case ActionType.REMOVE_ITEM:var el;if(action.item.selected=!1,el=action.item.element){el.selected=!1,el.removeAttribute("selected");var select=el.parentElement;select&&isHtmlSelectElement(select)&&select.type===PassedElementTypes.SelectOne&&(select.value="")}removeItem(action.item),state=state.filter((function(choice){return choice.id!==action.item.id}));break;case ActionType.REMOVE_CHOICE:removeItem(action.choice),state=state.filter((function(item){return item.id!==action.choice.id}));break;case ActionType.HIGHLIGHT_ITEM:var highlighted=action.highlighted,item=state.find((function(obj){return obj.id===action.item.id}));item&&item.highlighted!==highlighted&&(item.highlighted=highlighted,context&&updateClassList(item,highlighted?context.classNames.highlightedState:context.classNames.selectedState,highlighted?context.classNames.selectedState:context.classNames.highlightedState));break;default:update=!1}return{state:state,update:update}}function groups(s,action){var state=s,update=!0;switch(action.type){case ActionType.ADD_GROUP:state.push(action.group);break;case ActionType.CLEAR_CHOICES:state=[];break;default:update=!1}return{state:state,update:update}}function choices(s,action,context){var state=s,update=!0;switch(action.type){case ActionType.ADD_CHOICE:state.push(action.choice);break;case ActionType.REMOVE_CHOICE:action.choice.choiceEl=void 0,action.choice.group&&(action.choice.group.choices=action.choice.group.choices.filter((function(obj){return obj.id!==action.choice.id}))),state=state.filter((function(obj){return obj.id!==action.choice.id}));break;case ActionType.ADD_ITEM:case ActionType.REMOVE_ITEM:action.item.choiceEl=void 0;break;case ActionType.FILTER_CHOICES:var scoreLookup_1=[];action.results.forEach((function(result){scoreLookup_1[result.item.id]=result})),state.forEach((function(choice){var result=scoreLookup_1[choice.id];void 0!==result?(choice.score=result.score,choice.rank=result.rank,choice.active=!0):(choice.score=0,choice.rank=0,choice.active=!1),context&&context.appendGroupInSearch&&(choice.choiceEl=void 0)}));break;case ActionType.ACTIVATE_CHOICES:state.forEach((function(choice){choice.active=action.active,context&&context.appendGroupInSearch&&(choice.choiceEl=void 0)}));break;case ActionType.CLEAR_CHOICES:state=[];break;default:update=!1}return{state:state,update:update}}var reducers={groups:groups,items:items,choices:choices},Store=function(){function Store(context){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=context}return Object.defineProperty(Store.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),Store.prototype.changeSet=function(init){return{groups:init,items:init,choices:init}},Store.prototype.reset=function(){this._state=this.defaultState;var changes=this.changeSet(!0);this._txn?this._changeSet=changes:this._listeners.forEach((function(l){return l(changes)}))},Store.prototype.subscribe=function(onChange){return this._listeners.push(onChange),this},Store.prototype.dispatch=function(action){var _this=this,state=this._state,hasChanges=!1,changes=this._changeSet||this.changeSet(!1);Object.keys(reducers).forEach((function(key){var stateUpdate=reducers[key](state[key],action,_this._context);stateUpdate.update&&(hasChanges=!0,changes[key]=!0,state[key]=stateUpdate.state)})),hasChanges&&(this._txn?this._changeSet=changes:this._listeners.forEach((function(l){return l(changes)})))},Store.prototype.withTxn=function(func){this._txn++;try{func()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var changeSet_1=this._changeSet;changeSet_1&&(this._changeSet=void 0,this._listeners.forEach((function(l){return l(changeSet_1)})))}}},Object.defineProperty(Store.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"highlightedActiveItems",{get:function(){return this.items.filter((function(item){return!item.disabled&&item.active&&item.highlighted}))},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"activeChoices",{get:function(){return this.choices.filter((function(choice){return choice.active}))},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"searchableChoices",{get:function(){return this.choices.filter((function(choice){return!choice.disabled&&!choice.placeholder}))},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(Store.prototype,"activeGroups",{get:function(){var _this=this;return this.state.groups.filter((function(group){var isActive=group.active&&!group.disabled,hasActiveOptions=_this.state.choices.some((function(choice){return choice.active&&!choice.disabled}));return isActive&&hasActiveOptions}),[])},enumerable:!1,configurable:!0}),Store.prototype.inTxn=function(){return this._txn>0},Store.prototype.getChoiceById=function(id){return this.activeChoices.find((function(choice){return choice.id===id}))},Store.prototype.getGroupById=function(id){return this.groups.find((function(group){return group.id===id}))},Store}(),NoticeTypes={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:i+""}function isArray(value){return Array.isArray?Array.isArray(value):"[object Array]"===getTag(value)}const INFINITY=1/0;function baseToString(value){if("string"==typeof value)return value;let result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function toString(value){return null==value?"":baseToString(value)}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isBoolean(value){return!0===value||!1===value||isObjectLike(value)&&"[object Boolean]"==getTag(value)}function isObject(value){return"object"==typeof value}function isObjectLike(value){return isObject(value)&&null!==value}function isDefined(value){return null!=value}function isBlank(value){return!value.trim().length}function getTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":Object.prototype.toString.call(value)}const EXTENDED_SEARCH_UNAVAILABLE="Extended search is not available",INCORRECT_INDEX_TYPE="Incorrect 'index' type",LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY=key=>`Invalid value for key ${key}`,PATTERN_LENGTH_TOO_LARGE=max=>`Pattern length exceeds max of ${max}.`,MISSING_KEY_PROPERTY=name=>`Missing ${name} property in key`,INVALID_KEY_WEIGHT_VALUE=key=>`Property 'weight' in key '${key}' must be a positive integer`,hasOwn=Object.prototype.hasOwnProperty;class KeyStore{constructor(keys){this._keys=[],this._keyMap={};let totalWeight=0;keys.forEach((key=>{let obj=createKey(key);this._keys.push(obj),this._keyMap[obj.id]=obj,totalWeight+=obj.weight})),this._keys.forEach((key=>{key.weight/=totalWeight}))}get(keyId){return this._keyMap[keyId]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function createKey(key){let path=null,id=null,src=null,weight=1,getFn=null;if(isString(key)||isArray(key))src=key,path=createKeyPath(key),id=createKeyId(key);else{if(!hasOwn.call(key,"name"))throw new Error(MISSING_KEY_PROPERTY("name"));const name=key.name;if(src=name,hasOwn.call(key,"weight")&&(weight=key.weight,weight<=0))throw new Error(INVALID_KEY_WEIGHT_VALUE(name));path=createKeyPath(name),id=createKeyId(name),getFn=key.getFn}return{path:path,id:id,weight:weight,src:src,getFn:getFn}}function createKeyPath(key){return isArray(key)?key:key.split(".")}function createKeyId(key){return isArray(key)?key.join("."):key}function get(obj,path){let list=[],arr=!1;const deepGet=(obj,path,index)=>{if(isDefined(obj))if(path[index]){const value=obj[path[index]];if(!isDefined(value))return;if(index===path.length-1&&(isString(value)||isNumber(value)||isBoolean(value)))list.push(toString(value));else if(isArray(value)){arr=!0;for(let i=0,len=value.length;i<len;i+=1)deepGet(value[i],path,index+1)}else path.length&&deepGet(value,path,index+1)}else list.push(obj)};return deepGet(obj,isString(path)?path.split("."):path,0),arr?list:list[0]}const MatchOptions={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},BasicOptions={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(a,b)=>a.score===b.score?a.idx<b.idx?-1:1:a.score<b.score?-1:1},FuzzyOptions={location:0,threshold:.6,distance:100},AdvancedOptions={useExtendedSearch:!1,getFn:get,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Config=_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},BasicOptions),MatchOptions),FuzzyOptions),AdvancedOptions);const SPACE=/[^ ]+/g;function norm(weight=1,mantissa=3){const cache=new Map,m=Math.pow(10,mantissa);return{get(value){const numTokens=value.match(SPACE).length;if(cache.has(numTokens))return cache.get(numTokens);const norm=1/Math.pow(numTokens,.5*weight),n=parseFloat(Math.round(norm*m)/m);return cache.set(numTokens,n),n},clear(){cache.clear()}}}class FuseIndex{constructor({getFn:getFn=Config.getFn,fieldNormWeight:fieldNormWeight=Config.fieldNormWeight}={}){this.norm=norm(fieldNormWeight,3),this.getFn=getFn,this.isCreated=!1,this.setIndexRecords()}setSources(docs=[]){this.docs=docs}setIndexRecords(records=[]){this.records=records}setKeys(keys=[]){this.keys=keys,this._keysMap={},keys.forEach(((key,idx)=>{this._keysMap[key.id]=idx}))}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,isString(this.docs[0])?this.docs.forEach(((doc,docIndex)=>{this._addString(doc,docIndex)})):this.docs.forEach(((doc,docIndex)=>{this._addObject(doc,docIndex)})),this.norm.clear())}add(doc){const idx=this.size();isString(doc)?this._addString(doc,idx):this._addObject(doc,idx)}removeAt(idx){this.records.splice(idx,1);for(let i=idx,len=this.size();i<len;i+=1)this.records[i].i-=1}getValueForItemAtKeyId(item,keyId){return item[this._keysMap[keyId]]}size(){return this.records.length}_addString(doc,docIndex){if(!isDefined(doc)||isBlank(doc))return;let record={v:doc,i:docIndex,n:this.norm.get(doc)};this.records.push(record)}_addObject(doc,docIndex){let record={i:docIndex,$:{}};this.keys.forEach(((key,keyIndex)=>{let value=key.getFn?key.getFn(doc):this.getFn(doc,key.path);if(isDefined(value))if(isArray(value)){let subRecords=[];const stack=[{nestedArrIndex:-1,value:value}];for(;stack.length;){const{nestedArrIndex:nestedArrIndex,value:value}=stack.pop();if(isDefined(value))if(isString(value)&&!isBlank(value)){let subRecord={v:value,i:nestedArrIndex,n:this.norm.get(value)};subRecords.push(subRecord)}else isArray(value)&&value.forEach(((item,k)=>{stack.push({nestedArrIndex:k,value:item})}))}record.$[keyIndex]=subRecords}else if(isString(value)&&!isBlank(value)){let subRecord={v:value,n:this.norm.get(value)};record.$[keyIndex]=subRecord}})),this.records.push(record)}toJSON(){return{keys:this.keys,records:this.records}}}function createIndex(keys,docs,{getFn:getFn=Config.getFn,fieldNormWeight:fieldNormWeight=Config.fieldNormWeight}={}){const myIndex=new FuseIndex({getFn:getFn,fieldNormWeight:fieldNormWeight});return myIndex.setKeys(keys.map(createKey)),myIndex.setSources(docs),myIndex.create(),myIndex}function parseIndex(data,{getFn:getFn=Config.getFn,fieldNormWeight:fieldNormWeight=Config.fieldNormWeight}={}){const{keys:keys,records:records}=data,myIndex=new FuseIndex({getFn:getFn,fieldNormWeight:fieldNormWeight});return myIndex.setKeys(keys),myIndex.setIndexRecords(records),myIndex}function computeScore$1(pattern,{errors:errors=0,currentLocation:currentLocation=0,expectedLocation:expectedLocation=0,distance:distance=Config.distance,ignoreLocation:ignoreLocation=Config.ignoreLocation}={}){const accuracy=errors/pattern.length;if(ignoreLocation)return accuracy;const proximity=Math.abs(expectedLocation-currentLocation);return distance?accuracy+proximity/distance:proximity?1:accuracy}function convertMaskToIndices(matchmask=[],minMatchCharLength=Config.minMatchCharLength){let indices=[],start=-1,end=-1,i=0;for(let len=matchmask.length;i<len;i+=1){let match=matchmask[i];match&&-1===start?start=i:match||-1===start||(end=i-1,end-start+1>=minMatchCharLength&&indices.push([start,end]),start=-1)}return matchmask[i-1]&&i-start>=minMatchCharLength&&indices.push([start,i-1]),indices}const MAX_BITS=32;function search(text,pattern,patternAlphabet,{location:location=Config.location,distance:distance=Config.distance,threshold:threshold=Config.threshold,findAllMatches:findAllMatches=Config.findAllMatches,minMatchCharLength:minMatchCharLength=Config.minMatchCharLength,includeMatches:includeMatches=Config.includeMatches,ignoreLocation:ignoreLocation=Config.ignoreLocation}={}){if(pattern.length>32)throw new Error(PATTERN_LENGTH_TOO_LARGE(32));const patternLen=pattern.length,textLen=text.length,expectedLocation=Math.max(0,Math.min(location,textLen));let currentThreshold=threshold,bestLocation=expectedLocation;const computeMatches=minMatchCharLength>1||includeMatches,matchMask=computeMatches?Array(textLen):[];let index;for(;(index=text.indexOf(pattern,bestLocation))>-1;){let score=computeScore$1(pattern,{currentLocation:index,expectedLocation:expectedLocation,distance:distance,ignoreLocation:ignoreLocation});if(currentThreshold=Math.min(score,currentThreshold),bestLocation=index+patternLen,computeMatches){let i=0;for(;i<patternLen;)matchMask[index+i]=1,i+=1}}bestLocation=-1;let lastBitArr=[],finalScore=1,binMax=patternLen+textLen;const mask=1<<patternLen-1;for(let i=0;i<patternLen;i+=1){let binMin=0,binMid=binMax;for(;binMin<binMid;){computeScore$1(pattern,{errors:i,currentLocation:expectedLocation+binMid,expectedLocation:expectedLocation,distance:distance,ignoreLocation:ignoreLocation})<=currentThreshold?binMin=binMid:binMax=binMid,binMid=Math.floor((binMax-binMin)/2+binMin)}binMax=binMid;let start=Math.max(1,expectedLocation-binMid+1),finish=findAllMatches?textLen:Math.min(expectedLocation+binMid,textLen)+patternLen,bitArr=Array(finish+2);bitArr[finish+1]=(1<<i)-1;for(let j=finish;j>=start;j-=1){let currentLocation=j-1,charMatch=patternAlphabet[text.charAt(currentLocation)];if(computeMatches&&(matchMask[currentLocation]=+!!charMatch),bitArr[j]=(bitArr[j+1]<<1|1)&charMatch,i&&(bitArr[j]|=(lastBitArr[j+1]|lastBitArr[j])<<1|1|lastBitArr[j+1]),bitArr[j]&mask&&(finalScore=computeScore$1(pattern,{errors:i,currentLocation:currentLocation,expectedLocation:expectedLocation,distance:distance,ignoreLocation:ignoreLocation}),finalScore<=currentThreshold)){if(currentThreshold=finalScore,bestLocation=currentLocation,bestLocation<=expectedLocation)break;start=Math.max(1,2*expectedLocation-bestLocation)}}if(computeScore$1(pattern,{errors:i+1,currentLocation:expectedLocation,expectedLocation:expectedLocation,distance:distance,ignoreLocation:ignoreLocation})>currentThreshold)break;lastBitArr=bitArr}const result={isMatch:bestLocation>=0,score:Math.max(.001,finalScore)};if(computeMatches){const indices=convertMaskToIndices(matchMask,minMatchCharLength);indices.length?includeMatches&&(result.indices=indices):result.isMatch=!1}return result}function createPatternAlphabet(pattern){let mask={};for(let i=0,len=pattern.length;i<len;i+=1){const char=pattern.charAt(i);mask[char]=(mask[char]||0)|1<<len-i-1}return mask}class BitapSearch{constructor(pattern,{location:location=Config.location,threshold:threshold=Config.threshold,distance:distance=Config.distance,includeMatches:includeMatches=Config.includeMatches,findAllMatches:findAllMatches=Config.findAllMatches,minMatchCharLength:minMatchCharLength=Config.minMatchCharLength,isCaseSensitive:isCaseSensitive=Config.isCaseSensitive,ignoreLocation:ignoreLocation=Config.ignoreLocation}={}){if(this.options={location:location,threshold:threshold,distance:distance,includeMatches:includeMatches,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength,isCaseSensitive:isCaseSensitive,ignoreLocation:ignoreLocation},this.pattern=isCaseSensitive?pattern:pattern.toLowerCase(),this.chunks=[],!this.pattern.length)return;const addChunk=(pattern,startIndex)=>{this.chunks.push({pattern:pattern,alphabet:createPatternAlphabet(pattern),startIndex:startIndex})},len=this.pattern.length;if(len>32){let i=0;const remainder=len%32,end=len-remainder;for(;i<end;)addChunk(this.pattern.substr(i,32),i),i+=32;if(remainder){const startIndex=len-32;addChunk(this.pattern.substr(startIndex),startIndex)}}else addChunk(this.pattern,0)}searchIn(text){const{isCaseSensitive:isCaseSensitive,includeMatches:includeMatches}=this.options;if(isCaseSensitive||(text=text.toLowerCase()),this.pattern===text){let result={isMatch:!0,score:0};return includeMatches&&(result.indices=[[0,text.length-1]]),result}const{location:location,distance:distance,threshold:threshold,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength,ignoreLocation:ignoreLocation}=this.options;let allIndices=[],totalScore=0,hasMatches=!1;this.chunks.forEach((({pattern:pattern,alphabet:alphabet,startIndex:startIndex})=>{const{isMatch:isMatch,score:score,indices:indices}=search(text,pattern,alphabet,{location:location+startIndex,distance:distance,threshold:threshold,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength,includeMatches:includeMatches,ignoreLocation:ignoreLocation});isMatch&&(hasMatches=!0),totalScore+=score,isMatch&&indices&&(allIndices=[...allIndices,...indices])}));let result={isMatch:hasMatches,score:hasMatches?totalScore/this.chunks.length:1};return hasMatches&&includeMatches&&(result.indices=allIndices),result}}class BaseMatch{constructor(pattern){this.pattern=pattern}static isMultiMatch(pattern){return getMatch(pattern,this.multiRegex)}static isSingleMatch(pattern){return getMatch(pattern,this.singleRegex)}search(){}}function getMatch(pattern,exp){const matches=pattern.match(exp);return matches?matches[1]:null}class ExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(text){const isMatch=text===this.pattern;return{isMatch:isMatch,score:isMatch?0:1,indices:[0,this.pattern.length-1]}}}class InverseExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(text){const isMatch=-1===text.indexOf(this.pattern);return{isMatch:isMatch,score:isMatch?0:1,indices:[0,text.length-1]}}}class PrefixExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(text){const isMatch=text.startsWith(this.pattern);return{isMatch:isMatch,score:isMatch?0:1,indices:[0,this.pattern.length-1]}}}class InversePrefixExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(text){const isMatch=!text.startsWith(this.pattern);return{isMatch:isMatch,score:isMatch?0:1,indices:[0,text.length-1]}}}class SuffixExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(text){const isMatch=text.endsWith(this.pattern);return{isMatch:isMatch,score:isMatch?0:1,indices:[text.length-this.pattern.length,text.length-1]}}}class InverseSuffixExactMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(text){const isMatch=!text.endsWith(this.pattern);return{isMatch:isMatch,score:isMatch?0:1,indices:[0,text.length-1]}}}class FuzzyMatch extends BaseMatch{constructor(pattern,{location:location=Config.location,threshold:threshold=Config.threshold,distance:distance=Config.distance,includeMatches:includeMatches=Config.includeMatches,findAllMatches:findAllMatches=Config.findAllMatches,minMatchCharLength:minMatchCharLength=Config.minMatchCharLength,isCaseSensitive:isCaseSensitive=Config.isCaseSensitive,ignoreLocation:ignoreLocation=Config.ignoreLocation}={}){super(pattern),this._bitapSearch=new BitapSearch(pattern,{location:location,threshold:threshold,distance:distance,includeMatches:includeMatches,findAllMatches:findAllMatches,minMatchCharLength:minMatchCharLength,isCaseSensitive:isCaseSensitive,ignoreLocation:ignoreLocation})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(text){return this._bitapSearch.searchIn(text)}}class IncludeMatch extends BaseMatch{constructor(pattern){super(pattern)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(text){let index,location=0;const indices=[],patternLen=this.pattern.length;for(;(index=text.indexOf(this.pattern,location))>-1;)location=index+patternLen,indices.push([index,location-1]);const isMatch=!!indices.length;return{isMatch:isMatch,score:isMatch?0:1,indices:indices}}}const searchers=[ExactMatch,IncludeMatch,PrefixExactMatch,InversePrefixExactMatch,InverseSuffixExactMatch,SuffixExactMatch,InverseExactMatch,FuzzyMatch],searchersLen=searchers.length,SPACE_RE=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,OR_TOKEN="|";function parseQuery(pattern,options={}){return pattern.split("|").map((item=>{let query=item.trim().split(SPACE_RE).filter((item=>item&&!!item.trim())),results=[];for(let i=0,len=query.length;i<len;i+=1){const queryItem=query[i];let found=!1,idx=-1;for(;!found&&++idx<searchersLen;){const searcher=searchers[idx];let token=searcher.isMultiMatch(queryItem);token&&(results.push(new searcher(token,options)),found=!0)}if(!found)for(idx=-1;++idx<searchersLen;){const searcher=searchers[idx];let token=searcher.isSingleMatch(queryItem);if(token){results.push(new searcher(token,options));break}}}return results}))}const MultiMatchSet=new Set([FuzzyMatch.type,IncludeMatch.type]);class ExtendedSearch{constructor(pattern,{isCaseSensitive:isCaseSensitive=Config.isCaseSensitive,includeMatches:includeMatches=Config.includeMatches,minMatchCharLength:minMatchCharLength=Config.minMatchCharLength,ignoreLocation:ignoreLocation=Config.ignoreLocation,findAllMatches:findAllMatches=Config.findAllMatches,location:location=Config.location,threshold:threshold=Config.threshold,distance:distance=Config.distance}={}){this.query=null,this.options={isCaseSensitive:isCaseSensitive,includeMatches:includeMatches,minMatchCharLength:minMatchCharLength,findAllMatches:findAllMatches,ignoreLocation:ignoreLocation,location:location,threshold:threshold,distance:distance},this.pattern=isCaseSensitive?pattern:pattern.toLowerCase(),this.query=parseQuery(this.pattern,this.options)}static condition(_,options){return options.useExtendedSearch}searchIn(text){const query=this.query;if(!query)return{isMatch:!1,score:1};const{includeMatches:includeMatches,isCaseSensitive:isCaseSensitive}=this.options;text=isCaseSensitive?text:text.toLowerCase();let numMatches=0,allIndices=[],totalScore=0;for(let i=0,qLen=query.length;i<qLen;i+=1){const searchers=query[i];allIndices.length=0,numMatches=0;for(let j=0,pLen=searchers.length;j<pLen;j+=1){const searcher=searchers[j],{isMatch:isMatch,indices:indices,score:score}=searcher.search(text);if(!isMatch){totalScore=0,numMatches=0,allIndices.length=0;break}if(numMatches+=1,totalScore+=score,includeMatches){const type=searcher.constructor.type;MultiMatchSet.has(type)?allIndices=[...allIndices,...indices]:allIndices.push(indices)}}if(numMatches){let result={isMatch:!0,score:totalScore/numMatches};return includeMatches&&(result.indices=allIndices),result}}return{isMatch:!1,score:1}}}const registeredSearchers=[];function register(...args){registeredSearchers.push(...args)}function createSearcher(pattern,options){for(let i=0,len=registeredSearchers.length;i<len;i+=1){let searcherClass=registeredSearchers[i];if(searcherClass.condition(pattern,options))return new searcherClass(pattern,options)}return new BitapSearch(pattern,options)}const LogicalOperator={AND:"$and",OR:"$or"},KeyType={PATH:"$path",PATTERN:"$val"},isExpression=query=>!(!query[LogicalOperator.AND]&&!query[LogicalOperator.OR]),isPath=query=>!!query[KeyType.PATH],isLeaf=query=>!isArray(query)&&isObject(query)&&!isExpression(query),convertToExplicit=query=>({[LogicalOperator.AND]:Object.keys(query).map((key=>({[key]:query[key]})))});function parse(query,options,{auto:auto=!0}={}){const next=query=>{let keys=Object.keys(query);const isQueryPath=isPath(query);if(!isQueryPath&&keys.length>1&&!isExpression(query))return next(convertToExplicit(query));if(isLeaf(query)){const key=isQueryPath?query[KeyType.PATH]:keys[0],pattern=isQueryPath?query[KeyType.PATTERN]:query[key];if(!isString(pattern))throw new Error(LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key));const obj={keyId:createKeyId(key),pattern:pattern};return auto&&(obj.searcher=createSearcher(pattern,options)),obj}let node={children:[],operator:keys[0]};return keys.forEach((key=>{const value=query[key];isArray(value)&&value.forEach((item=>{node.children.push(next(item))}))})),node};return isExpression(query)||(query=convertToExplicit(query)),next(query)}function computeScore(results,{ignoreFieldNorm:ignoreFieldNorm=Config.ignoreFieldNorm}){results.forEach((result=>{let totalScore=1;result.matches.forEach((({key:key,norm:norm,score:score})=>{const weight=key?key.weight:null;totalScore*=Math.pow(0===score&&weight?Number.EPSILON:score,(weight||1)*(ignoreFieldNorm?1:norm))})),result.score=totalScore}))}function transformMatches(result,data){const matches=result.matches;data.matches=[],isDefined(matches)&&matches.forEach((match=>{if(!isDefined(match.indices)||!match.indices.length)return;const{indices:indices,value:value}=match;let obj={indices:indices,value:value};match.key&&(obj.key=match.key.src),match.idx>-1&&(obj.refIndex=match.idx),data.matches.push(obj)}))}function transformScore(result,data){data.score=result.score}function format(results,docs,{includeMatches:includeMatches=Config.includeMatches,includeScore:includeScore=Config.includeScore}={}){const transformers=[];return includeMatches&&transformers.push(transformMatches),includeScore&&transformers.push(transformScore),results.map((result=>{const{idx:idx}=result,data={item:docs[idx],refIndex:idx};return transformers.length&&transformers.forEach((transformer=>{transformer(result,data)})),data}))}class Fuse{constructor(docs,options={},index){this.options=_objectSpread2(_objectSpread2({},Config),options),this.options.useExtendedSearch,this._keyStore=new KeyStore(this.options.keys),this.setCollection(docs,index)}setCollection(docs,index){if(this._docs=docs,index&&!(index instanceof FuseIndex))throw new Error(INCORRECT_INDEX_TYPE);this._myIndex=index||createIndex(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(doc){isDefined(doc)&&(this._docs.push(doc),this._myIndex.add(doc))}remove(predicate=(()=>!1)){const results=[];for(let i=0,len=this._docs.length;i<len;i+=1){const doc=this._docs[i];predicate(doc,i)&&(this.removeAt(i),i-=1,len-=1,results.push(doc))}return results}removeAt(idx){this._docs.splice(idx,1),this._myIndex.removeAt(idx)}getIndex(){return this._myIndex}search(query,{limit:limit=-1}={}){const{includeMatches:includeMatches,includeScore:includeScore,shouldSort:shouldSort,sortFn:sortFn,ignoreFieldNorm:ignoreFieldNorm}=this.options;let results=isString(query)?isString(this._docs[0])?this._searchStringList(query):this._searchObjectList(query):this._searchLogical(query);return computeScore(results,{ignoreFieldNorm:ignoreFieldNorm}),shouldSort&&results.sort(sortFn),isNumber(limit)&&limit>-1&&(results=results.slice(0,limit)),format(results,this._docs,{includeMatches:includeMatches,includeScore:includeScore})}_searchStringList(query){const searcher=createSearcher(query,this.options),{records:records}=this._myIndex,results=[];return records.forEach((({v:text,i:idx,n:norm})=>{if(!isDefined(text))return;const{isMatch:isMatch,score:score,indices:indices}=searcher.searchIn(text);isMatch&&results.push({item:text,idx:idx,matches:[{score:score,value:text,norm:norm,indices:indices}]})})),results}_searchLogical(query){const expression=parse(query,this.options),evaluate=(node,item,idx)=>{if(!node.children){const{keyId:keyId,searcher:searcher}=node,matches=this._findMatches({key:this._keyStore.get(keyId),value:this._myIndex.getValueForItemAtKeyId(item,keyId),searcher:searcher});return matches&&matches.length?[{idx:idx,item:item,matches:matches}]:[]}const res=[];for(let i=0,len=node.children.length;i<len;i+=1){const child=node.children[i],result=evaluate(child,item,idx);if(result.length)res.push(...result);else if(node.operator===LogicalOperator.AND)return[]}return res},records=this._myIndex.records,resultMap={},results=[];return records.forEach((({$:item,i:idx})=>{if(isDefined(item)){let expResults=evaluate(expression,item,idx);expResults.length&&(resultMap[idx]||(resultMap[idx]={idx:idx,item:item,matches:[]},results.push(resultMap[idx])),expResults.forEach((({matches:matches})=>{resultMap[idx].matches.push(...matches)})))}})),results}_searchObjectList(query){const searcher=createSearcher(query,this.options),{keys:keys,records:records}=this._myIndex,results=[];return records.forEach((({$:item,i:idx})=>{if(!isDefined(item))return;let matches=[];keys.forEach(((key,keyIndex)=>{matches.push(...this._findMatches({key:key,value:item[keyIndex],searcher:searcher}))})),matches.length&&results.push({idx:idx,item:item,matches:matches})})),results}_findMatches({key:key,value:value,searcher:searcher}){if(!isDefined(value))return[];let matches=[];if(isArray(value))value.forEach((({v:text,i:idx,n:norm})=>{if(!isDefined(text))return;const{isMatch:isMatch,score:score,indices:indices}=searcher.searchIn(text);isMatch&&matches.push({score:score,key:key,value:text,idx:idx,norm:norm,indices:indices})}));else{const{v:text,n:norm}=value,{isMatch:isMatch,score:score,indices:indices}=searcher.searchIn(text);isMatch&&matches.push({score:score,key:key,value:text,norm:norm,indices:indices})}return matches}}Fuse.version="7.0.0",Fuse.createIndex=createIndex,Fuse.parseIndex=parseIndex,Fuse.config=Config,Fuse.parseQuery=parse,register(ExtendedSearch);var SearchByFuse=function(){function SearchByFuse(config){this._haystack=[],this._fuseOptions=__assign(__assign({},config.fuseOptions),{keys:__spreadArray([],config.searchFields,!0),includeMatches:!0})}return SearchByFuse.prototype.index=function(data){this._haystack=data,this._fuse&&this._fuse.setCollection(data)},SearchByFuse.prototype.reset=function(){this._haystack=[],this._fuse=void 0},SearchByFuse.prototype.isEmptyIndex=function(){return!this._haystack.length},SearchByFuse.prototype.search=function(needle){return this._fuse||(this._fuse=new Fuse(this._haystack,this._fuseOptions)),this._fuse.search(needle).map((function(value,i){return{item:value.item,score:value.score||0,rank:i+1}}))},SearchByFuse}();function getSearcher(config){return new SearchByFuse(config)}var isEmptyObject=function(obj){for(var prop in obj)if(Object.prototype.hasOwnProperty.call(obj,prop))return!1;return!0},assignCustomProperties=function(el,choice,withCustomProperties){var dataset=el.dataset,customProperties=choice.customProperties,labelClass=choice.labelClass,labelDescription=choice.labelDescription;labelClass&&(dataset.labelClass=getClassNames(labelClass).join(" ")),labelDescription&&(dataset.labelDescription=labelDescription),withCustomProperties&&customProperties&&("string"==typeof customProperties?dataset.customProperties=customProperties:"object"!=typeof customProperties||isEmptyObject(customProperties)||(dataset.customProperties=JSON.stringify(customProperties)))},addAriaLabel=function(docRoot,id,element){var label=id&&docRoot.querySelector("label[for='".concat(id,"']")),text=label&&label.innerText;text&&element.setAttribute("aria-label",text)},templates={containerOuter:function(_a,dir,isSelectElement,isSelectOneElement,searchEnabled,passedElementType,labelId){var containerOuter=_a.classNames.containerOuter,div=document.createElement("div");return addClassesToElement(div,containerOuter),div.dataset.type=passedElementType,dir&&(div.dir=dir),isSelectOneElement&&(div.tabIndex=0),isSelectElement&&(div.setAttribute("role",searchEnabled?"combobox":"listbox"),searchEnabled?div.setAttribute("aria-autocomplete","list"):labelId||addAriaLabel(this._docRoot,this.passedElement.element.id,div),div.setAttribute("aria-haspopup","true"),div.setAttribute("aria-expanded","false")),labelId&&div.setAttribute("aria-labelledby",labelId),div},containerInner:function(_a){var containerInner=_a.classNames.containerInner,div=document.createElement("div");return addClassesToElement(div,containerInner),div},itemList:function(_a,isSelectOneElement){var searchEnabled=_a.searchEnabled,_b=_a.classNames,list=_b.list,listSingle=_b.listSingle,listItems=_b.listItems,div=document.createElement("div");return addClassesToElement(div,list),addClassesToElement(div,isSelectOneElement?listSingle:listItems),this._isSelectElement&&searchEnabled&&div.setAttribute("role","listbox"),div},placeholder:function(_a,value){var allowHTML=_a.allowHTML,placeholder=_a.classNames.placeholder,div=document.createElement("div");return addClassesToElement(div,placeholder),setElementHtml(div,allowHTML,value),div},item:function(_a,choice,removeItemButton){var allowHTML=_a.allowHTML,removeItemButtonAlignLeft=_a.removeItemButtonAlignLeft,removeItemIconText=_a.removeItemIconText,removeItemLabelText=_a.removeItemLabelText,_b=_a.classNames,item=_b.item,button=_b.button,highlightedState=_b.highlightedState,itemSelectable=_b.itemSelectable,placeholder=_b.placeholder,rawValue=unwrapStringForRaw(choice.value),div=document.createElement("div");if(addClassesToElement(div,item),choice.labelClass){var spanLabel=document.createElement("span");setElementHtml(spanLabel,allowHTML,choice.label),addClassesToElement(spanLabel,choice.labelClass),div.appendChild(spanLabel)}else setElementHtml(div,allowHTML,choice.label);if(div.dataset.item="",div.dataset.id=choice.id,div.dataset.value=rawValue,assignCustomProperties(div,choice,!0),(choice.disabled||this.containerOuter.isDisabled)&&div.setAttribute("aria-disabled","true"),this._isSelectElement&&(div.setAttribute("aria-selected","true"),div.setAttribute("role","option")),choice.placeholder&&(addClassesToElement(div,placeholder),div.dataset.placeholder=""),addClassesToElement(div,choice.highlighted?highlightedState:itemSelectable),removeItemButton){choice.disabled&&removeClassesFromElement(div,itemSelectable),div.dataset.deletable="";var removeButton=document.createElement("button");removeButton.type="button",addClassesToElement(removeButton,button),setElementHtml(removeButton,!0,resolveNoticeFunction(removeItemIconText,choice.value));var REMOVE_ITEM_LABEL=resolveNoticeFunction(removeItemLabelText,choice.value);REMOVE_ITEM_LABEL&&removeButton.setAttribute("aria-label",REMOVE_ITEM_LABEL),removeButton.dataset.button="",removeItemButtonAlignLeft?div.insertAdjacentElement("afterbegin",removeButton):div.appendChild(removeButton)}return div},choiceList:function(_a,isSelectOneElement){var list=_a.classNames.list,div=document.createElement("div");return addClassesToElement(div,list),isSelectOneElement||div.setAttribute("aria-multiselectable","true"),div.setAttribute("role","listbox"),div},choiceGroup:function(_a,_b){var allowHTML=_a.allowHTML,_c=_a.classNames,group=_c.group,groupHeading=_c.groupHeading,itemDisabled=_c.itemDisabled,id=_b.id,label=_b.label,disabled=_b.disabled,rawLabel=unwrapStringForRaw(label),div=document.createElement("div");addClassesToElement(div,group),disabled&&addClassesToElement(div,itemDisabled),div.setAttribute("role","group"),div.dataset.group="",div.dataset.id=id,div.dataset.value=rawLabel,disabled&&div.setAttribute("aria-disabled","true");var heading=document.createElement("div");return addClassesToElement(heading,groupHeading),setElementHtml(heading,allowHTML,label||""),div.appendChild(heading),div},choice:function(_a,choice,selectText,groupName){var allowHTML=_a.allowHTML,_b=_a.classNames,item=_b.item,itemChoice=_b.itemChoice,itemSelectable=_b.itemSelectable,selectedState=_b.selectedState,itemDisabled=_b.itemDisabled,description=_b.description,placeholder=_b.placeholder,label=choice.label,rawValue=unwrapStringForRaw(choice.value),div=document.createElement("div");div.id=choice.elementId,addClassesToElement(div,item),addClassesToElement(div,itemChoice),groupName&&"string"==typeof label&&(label=escapeForTemplate(allowHTML,label),label={trusted:label+=" (".concat(groupName,")")});var describedBy=div;if(choice.labelClass){var spanLabel=document.createElement("span");setElementHtml(spanLabel,allowHTML,label),addClassesToElement(spanLabel,choice.labelClass),describedBy=spanLabel,div.appendChild(spanLabel)}else setElementHtml(div,allowHTML,label);if(choice.labelDescription){var descId="".concat(choice.elementId,"-description");describedBy.setAttribute("aria-describedby",descId);var spanDesc=document.createElement("span");setElementHtml(spanDesc,allowHTML,choice.labelDescription),spanDesc.id=descId,addClassesToElement(spanDesc,description),div.appendChild(spanDesc)}return choice.selected&&addClassesToElement(div,selectedState),choice.placeholder&&addClassesToElement(div,placeholder),div.setAttribute("role",choice.group?"treeitem":"option"),div.dataset.choice="",div.dataset.id=choice.id,div.dataset.value=rawValue,selectText&&(div.dataset.selectText=selectText),choice.group&&(div.dataset.groupId="".concat(choice.group.id)),assignCustomProperties(div,choice,!1),choice.disabled?(addClassesToElement(div,itemDisabled),div.dataset.choiceDisabled="",div.setAttribute("aria-disabled","true")):(addClassesToElement(div,itemSelectable),div.dataset.choiceSelectable=""),div},input:function(_a,placeholderValue){var _b=_a.classNames,input=_b.input,inputCloned=_b.inputCloned,labelId=_a.labelId,inp=document.createElement("input");return inp.type="search",addClassesToElement(inp,input),addClassesToElement(inp,inputCloned),inp.autocomplete="off",inp.autocapitalize="off",inp.spellcheck=!1,inp.setAttribute("role","textbox"),inp.setAttribute("aria-autocomplete","list"),placeholderValue?inp.setAttribute("aria-label",placeholderValue):labelId||addAriaLabel(this._docRoot,this.passedElement.element.id,inp),inp},dropdown:function(_a){var _b=_a.classNames,list=_b.list,listDropdown=_b.listDropdown,div=document.createElement("div");return addClassesToElement(div,list),addClassesToElement(div,listDropdown),div.setAttribute("aria-expanded","false"),div},notice:function(_a,innerHTML,type){var _b=_a.classNames,item=_b.item,itemChoice=_b.itemChoice,addChoice=_b.addChoice,noResults=_b.noResults,noChoices=_b.noChoices,noticeItem=_b.notice;void 0===type&&(type=NoticeTypes.generic);var notice=document.createElement("div");switch(setElementHtml(notice,!0,innerHTML),addClassesToElement(notice,item),addClassesToElement(notice,itemChoice),addClassesToElement(notice,noticeItem),type){case NoticeTypes.addChoice:addClassesToElement(notice,addChoice);break;case NoticeTypes.noResults:addClassesToElement(notice,noResults);break;case NoticeTypes.noChoices:addClassesToElement(notice,noChoices)}return type===NoticeTypes.addChoice&&(notice.dataset.choiceSelectable="",notice.dataset.choice=""),notice},option:function(choice){var labelValue=unwrapStringForRaw(choice.label),opt=new Option(labelValue,choice.value,!1,choice.selected);return assignCustomProperties(opt,choice,!0),opt.disabled=choice.disabled,choice.selected&&opt.setAttribute("selected",""),opt}},IS_IE11="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,USER_DEFAULTS={},parseDataSetId=function(element){if(element)return element.dataset.id?parseInt(element.dataset.id,10):void 0},selectableChoiceIdentifier="[data-choice-selectable]",Choices=function(){function Choices(element,userConfig){void 0===element&&(element="[data-choice]"),void 0===userConfig&&(userConfig={});var _this=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var defaults=Choices.defaults;this.config=__assign(__assign(__assign({},defaults.allOptions),defaults.options),userConfig),ObjectsInConfig.forEach((function(key){_this.config[key]=__assign(__assign(__assign({},defaults.allOptions[key]),defaults.options[key]),userConfig[key])}));var config=this.config;config.silent||this._validateConfig();var docRoot=config.shadowRoot||document.documentElement;this._docRoot=docRoot;var passedElement="string"==typeof element?docRoot.querySelector(element):element;if(!passedElement||"object"!=typeof passedElement||!isHtmlInputElement(passedElement)&&!isHtmlSelectElement(passedElement)){if(!passedElement&&"string"==typeof element)throw TypeError("Selector ".concat(element," failed to find an element"));throw TypeError("Expected one of the following types text|select-one|select-multiple")}var elementType=passedElement.type,isText=elementType===PassedElementTypes.Text;(isText||1!==config.maxItemCount)&&(config.singleModeForMultiSelect=!1),config.singleModeForMultiSelect&&(elementType=PassedElementTypes.SelectMultiple);var isSelectOne=elementType===PassedElementTypes.SelectOne,isSelectMultiple=elementType===PassedElementTypes.SelectMultiple,isSelect=isSelectOne||isSelectMultiple;if(this._elementType=elementType,this._isTextElement=isText,this._isSelectOneElement=isSelectOne,this._isSelectMultipleElement=isSelectMultiple,this._isSelectElement=isSelectOne||isSelectMultiple,this._canAddUserChoices=isText&&config.addItems||isSelect&&config.addChoices,"boolean"!=typeof config.renderSelectedChoices&&(config.renderSelectedChoices="always"===config.renderSelectedChoices||isSelectOne),"auto"===config.closeDropdownOnSelect?config.closeDropdownOnSelect=isText||isSelectOne||config.singleModeForMultiSelect:config.closeDropdownOnSelect=coerceBool(config.closeDropdownOnSelect),config.placeholder&&(config.placeholderValue?this._hasNonChoicePlaceholder=!0:passedElement.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,config.placeholderValue=passedElement.dataset.placeholder)),userConfig.addItemFilter&&"function"!=typeof userConfig.addItemFilter){var re=userConfig.addItemFilter instanceof RegExp?userConfig.addItemFilter:new RegExp(userConfig.addItemFilter);config.addItemFilter=re.test.bind(re)}if(this._isTextElement)this.passedElement=new WrappedInput({element:passedElement,classNames:config.classNames});else{var selectEl=passedElement;this.passedElement=new WrappedSelect({element:selectEl,classNames:config.classNames,template:function(data){return _this._templates.option(data)},extractPlaceholder:config.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new Store(config),this._currentValue="",config.searchEnabled=!isText&&config.searchEnabled||isSelectMultiple,this._canSearch=config.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=generateId(passedElement,"choices-"),this._direction=passedElement.dir,!this._direction){var elementDirection=window.getComputedStyle(passedElement).direction;elementDirection!==window.getComputedStyle(document.documentElement).direction&&(this._direction=elementDirection)}if(this._idNames={itemChoice:"item-choice"},this._templates=defaults.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive)return config.silent||console.warn("Trying to initialise Choices on element already initialised",{element:element}),this.initialised=!0,void(this.initialisedOK=!1);this.init(),this._initialItems=this._store.items.map((function(choice){return choice.value}))}return Object.defineProperty(Choices,"defaults",{get:function(){return Object.preventExtensions({get options(){return USER_DEFAULTS},get allOptions(){return DEFAULT_CONFIG},get templates(){return templates}})},enumerable:!1,configurable:!0}),Choices.prototype.init=function(){if(!this.initialised&&void 0===this.initialisedOK){this._searcher=getSearcher(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var callbackOnInit=this.config.callbackOnInit;"function"==typeof callbackOnInit&&callbackOnInit.call(this)}},Choices.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=Choices.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},Choices.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},Choices.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},Choices.prototype.highlightItem=function(item,runEvent){if(void 0===runEvent&&(runEvent=!0),!item||!item.id)return this;var choice=this._store.items.find((function(c){return c.id===item.id}));return!choice||choice.highlighted||(this._store.dispatch(highlightItem(choice,!0)),runEvent&&this.passedElement.triggerEvent(EventType.highlightItem,this._getChoiceForOutput(choice))),this},Choices.prototype.unhighlightItem=function(item,runEvent){if(void 0===runEvent&&(runEvent=!0),!item||!item.id)return this;var choice=this._store.items.find((function(c){return c.id===item.id}));return choice&&choice.highlighted?(this._store.dispatch(highlightItem(choice,!1)),runEvent&&this.passedElement.triggerEvent(EventType.unhighlightItem,this._getChoiceForOutput(choice)),this):this},Choices.prototype.highlightAll=function(){var _this=this;return this._store.withTxn((function(){_this._store.items.forEach((function(item){item.highlighted||(_this._store.dispatch(highlightItem(item,!0)),_this.passedElement.triggerEvent(EventType.highlightItem,_this._getChoiceForOutput(item)))}))})),this},Choices.prototype.unhighlightAll=function(){var _this=this;return this._store.withTxn((function(){_this._store.items.forEach((function(item){item.highlighted&&(_this._store.dispatch(highlightItem(item,!1)),_this.passedElement.triggerEvent(EventType.highlightItem,_this._getChoiceForOutput(item)))}))})),this},Choices.prototype.removeActiveItemsByValue=function(value){var _this=this;return this._store.withTxn((function(){_this._store.items.filter((function(item){return item.value===value})).forEach((function(item){return _this._removeItem(item)}))})),this},Choices.prototype.removeActiveItems=function(excludedId){var _this=this;return this._store.withTxn((function(){_this._store.items.filter((function(_a){return _a.id!==excludedId})).forEach((function(item){return _this._removeItem(item)}))})),this},Choices.prototype.removeHighlightedItems=function(runEvent){var _this=this;return void 0===runEvent&&(runEvent=!1),this._store.withTxn((function(){_this._store.highlightedActiveItems.forEach((function(item){_this._removeItem(item),runEvent&&_this._triggerChange(item.value)}))})),this},Choices.prototype.showDropdown=function(preventInputFocus){var _this=this;return this.dropdown.isActive||requestAnimationFrame((function(){_this.dropdown.show();var rect=_this.dropdown.element.getBoundingClientRect();_this.containerOuter.open(rect.bottom,rect.height),!preventInputFocus&&_this._canSearch&&_this.input.focus(),_this.passedElement.triggerEvent(EventType.showDropdown)})),this},Choices.prototype.hideDropdown=function(preventInputBlur){var _this=this;return this.dropdown.isActive?(requestAnimationFrame((function(){_this.dropdown.hide(),_this.containerOuter.close(),!preventInputBlur&&_this._canSearch&&(_this.input.removeActiveDescendant(),_this.input.blur()),_this.passedElement.triggerEvent(EventType.hideDropdown)})),this):this},Choices.prototype.getValue=function(valueOnly){var _this=this,values=this._store.items.map((function(item){return valueOnly?item.value:_this._getChoiceForOutput(item)}));return this._isSelectOneElement||this.config.singleModeForMultiSelect?values[0]:values},Choices.prototype.setValue=function(items){var _this=this;return this.initialisedOK?(this._store.withTxn((function(){items.forEach((function(value){value&&_this._addChoice(mapInputToChoice(value,!1))}))})),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},Choices.prototype.setChoiceByValue=function(value){var _this=this;return this.initialisedOK?(this._isTextElement||(this._store.withTxn((function(){(Array.isArray(value)?value:[value]).forEach((function(val){return _this._findAndSelectChoiceByValue(val)})),_this.unhighlightAll()})),this._searcher.reset()),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},Choices.prototype.setChoices=function(choicesArrayOrFetcher,value,label,replaceChoices,clearSearchFlag){var _this=this;if(void 0===choicesArrayOrFetcher&&(choicesArrayOrFetcher=[]),void 0===value&&(value="value"),void 0===label&&(label="label"),void 0===replaceChoices&&(replaceChoices=!1),void 0===clearSearchFlag&&(clearSearchFlag=!0),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if("string"!=typeof value||!value)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(replaceChoices&&this.clearChoices(),"function"==typeof choicesArrayOrFetcher){var fetcher_1=choicesArrayOrFetcher(this);if("function"==typeof Promise&&fetcher_1 instanceof Promise)return new Promise((function(resolve){return requestAnimationFrame(resolve)})).then((function(){return _this._handleLoadingState(!0)})).then((function(){return fetcher_1})).then((function(data){return _this.setChoices(data,value,label,replaceChoices)})).catch((function(err){_this.config.silent||console.error(err)})).then((function(){return _this._handleLoadingState(!1)})).then((function(){return _this}));if(!Array.isArray(fetcher_1))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof fetcher_1));return this.setChoices(fetcher_1,value,label,!1)}if(!Array.isArray(choicesArrayOrFetcher))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn((function(){clearSearchFlag&&(_this._isSearching=!1);var isDefaultValue="value"===value,isDefaultLabel="label"===label;choicesArrayOrFetcher.forEach((function(groupOrChoice){if("choices"in groupOrChoice){var group=groupOrChoice;isDefaultLabel||(group=__assign(__assign({},group),{label:group[label]})),_this._addGroup(mapInputToChoice(group,!0))}else{var choice=groupOrChoice;isDefaultLabel&&isDefaultValue||(choice=__assign(__assign({},choice),{value:choice[value],label:choice[label]})),_this._addChoice(mapInputToChoice(choice,!1))}})),_this.unhighlightAll()})),this._searcher.reset(),this},Choices.prototype.refresh=function(withEvents,selectFirstOption,deselectAll){var _this=this;return void 0===withEvents&&(withEvents=!1),void 0===selectFirstOption&&(selectFirstOption=!1),void 0===deselectAll&&(deselectAll=!1),this._isSelectElement?(this._store.withTxn((function(){var choicesFromOptions=_this.passedElement.optionsAsChoices(),existingItems={};deselectAll||_this._store.items.forEach((function(choice){choice.id&&choice.active&&choice.selected&&!choice.disabled&&(existingItems[choice.value]=!0)})),_this.clearStore(!1);var updateChoice=function(choice){deselectAll?_this._store.dispatch(removeItem$1(choice)):existingItems[choice.value]&&(choice.selected=!0)};choicesFromOptions.forEach((function(groupOrChoice){"choices"in groupOrChoice?groupOrChoice.choices.forEach(updateChoice):updateChoice(groupOrChoice)})),_this._addPredefinedChoices(choicesFromOptions,selectFirstOption,withEvents),_this._isSearching&&_this._searchChoices(_this.input.value)})),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},Choices.prototype.removeChoice=function(value){var choice=this._store.choices.find((function(c){return c.value===value}));return choice?(this._clearNotice(),this._store.dispatch(removeChoice(choice)),this._searcher.reset(),choice.selected&&this.passedElement.triggerEvent(EventType.removeItem,this._getChoiceForOutput(choice)),this):this},Choices.prototype.clearChoices=function(){var _this=this;return this._store.withTxn((function(){_this._store.choices.forEach((function(choice){choice.selected||_this._store.dispatch(removeChoice(choice))}))})),this._searcher.reset(),this},Choices.prototype.clearStore=function(clearOptions){return void 0===clearOptions&&(clearOptions=!0),this._stopSearch(),clearOptions&&this.passedElement.element.replaceChildren(""),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._store.reset(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this._searcher.reset(),this},Choices.prototype.clearInput=function(){var shouldSetInputWidth=!this._isSelectOneElement;return this.input.clear(shouldSetInputWidth),this._stopSearch(),this},Choices.prototype._validateConfig=function(){var config=this.config,invalidConfigOptions=diff(config,DEFAULT_CONFIG);invalidConfigOptions.length&&console.warn("Unknown config option(s) passed",invalidConfigOptions.join(", ")),config.allowHTML&&config.allowHtmlUserInput&&(config.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),config.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},Choices.prototype._render=function(changes){void 0===changes&&(changes={choices:!0,groups:!0,items:!0}),this._store.inTxn()||(this._isSelectElement&&(changes.choices||changes.groups)&&this._renderChoices(),changes.items&&this._renderItems())},Choices.prototype._renderChoices=function(){var _this=this;if(this._canAddItems()){var config=this.config,isSearching=this._isSearching,_b=this._store,activeGroups=_b.activeGroups,activeChoices=_b.activeChoices,renderLimit=0;if(isSearching&&config.searchResultLimit>0?renderLimit=config.searchResultLimit:config.renderChoiceLimit>0&&(renderLimit=config.renderChoiceLimit),this._isSelectElement){var backingOptions=activeChoices.filter((function(choice){return!choice.element}));backingOptions.length&&this.passedElement.addOptions(backingOptions)}var fragment=document.createDocumentFragment(),renderableChoices=function(choices){return choices.filter((function(choice){return!choice.placeholder&&(isSearching?!!choice.rank:config.renderSelectedChoices||!choice.selected)}))},selectableChoices=!1,renderChoices=function(choices,withinGroup,groupLabel){isSearching?choices.sort(sortByRank):config.shouldSort&&choices.sort(config.sorter);var choiceLimit=choices.length;choiceLimit=!withinGroup&&renderLimit&&choiceLimit>renderLimit?renderLimit:choiceLimit,choiceLimit--,choices.every((function(choice,index){var dropdownItem=choice.choiceEl||_this._templates.choice(config,choice,config.itemSelectText,groupLabel);return choice.choiceEl=dropdownItem,fragment.appendChild(dropdownItem),choice.disabled||!isSearching&&choice.selected||(selectableChoices=!0),index<choiceLimit}))};activeChoices.length&&(config.resetScrollPosition&&requestAnimationFrame((function(){return _this.choiceList.scrollToTop()})),this._hasNonChoicePlaceholder||isSearching||!this._isSelectOneElement||renderChoices(activeChoices.filter((function(choice){return choice.placeholder&&!choice.group})),!1,void 0),activeGroups.length&&!isSearching?(config.shouldSort&&activeGroups.sort(config.sorter),renderChoices(activeChoices.filter((function(choice){return!choice.placeholder&&!choice.group})),!1,void 0),activeGroups.forEach((function(group){var groupChoices=renderableChoices(group.choices);if(groupChoices.length){if(group.label){var dropdownGroup=group.groupEl||_this._templates.choiceGroup(_this.config,group);group.groupEl=dropdownGroup,dropdownGroup.remove(),fragment.appendChild(dropdownGroup)}renderChoices(groupChoices,!0,config.appendGroupInSearch&&isSearching?group.label:void 0)}}))):renderChoices(renderableChoices(activeChoices),!1,void 0)),selectableChoices||(this._notice||(this._notice={text:resolveStringFunction(isSearching?config.noResultsText:config.noChoicesText),type:isSearching?NoticeTypes.noResults:NoticeTypes.noChoices}),fragment.replaceChildren("")),this._renderNotice(fragment),this.choiceList.element.replaceChildren(fragment),selectableChoices&&this._highlightChoice()}},Choices.prototype._renderItems=function(){var _this=this,items=this._store.items||[],itemList=this.itemList.element,config=this.config,fragment=document.createDocumentFragment(),itemFromList=function(item){return itemList.querySelector('[data-item][data-id="'.concat(item.id,'"]'))},addItemToFragment=function(item){var el=item.itemEl;el&&el.parentElement||(el=itemFromList(item)||_this._templates.item(config,item,config.removeItemButton),item.itemEl=el,fragment.appendChild(el))};items.forEach(addItemToFragment);var addItems=!!fragment.childNodes.length;if(this._isSelectOneElement&&this._hasNonChoicePlaceholder){var existingItems=itemList.children.length;if(addItems||existingItems>1){var placeholder=itemList.querySelector(getClassNamesSelector(config.classNames.placeholder));placeholder&&placeholder.remove()}else existingItems||(addItems=!0,addItemToFragment(mapInputToChoice({selected:!0,value:"",label:config.placeholderValue||"",placeholder:!0},!1)))}addItems&&(itemList.append(fragment),config.shouldSortItems&&!this._isSelectOneElement&&(items.sort(config.sorter),items.forEach((function(item){var el=itemFromList(item);el&&(el.remove(),fragment.append(el))})),itemList.append(fragment))),this._isTextElement&&(this.passedElement.value=items.map((function(_a){return _a.value})).join(config.delimiter))},Choices.prototype._displayNotice=function(text,type,openDropdown){void 0===openDropdown&&(openDropdown=!0);var oldNotice=this._notice;oldNotice&&(oldNotice.type===type&&oldNotice.text===text||oldNotice.type===NoticeTypes.addChoice&&(type===NoticeTypes.noResults||type===NoticeTypes.noChoices))?openDropdown&&this.showDropdown(!0):(this._clearNotice(),this._notice=text?{text:text,type:type}:void 0,this._renderNotice(),openDropdown&&text&&this.showDropdown(!0))},Choices.prototype._clearNotice=function(){if(this._notice){var noticeElement=this.choiceList.element.querySelector(getClassNamesSelector(this.config.classNames.notice));noticeElement&&noticeElement.remove(),this._notice=void 0}},Choices.prototype._renderNotice=function(fragment){var noticeConf=this._notice;if(noticeConf){var notice=this._templates.notice(this.config,noticeConf.text,noticeConf.type);fragment?fragment.append(notice):this.choiceList.prepend(notice)}},Choices.prototype._getChoiceForOutput=function(choice,keyCode){return{id:choice.id,highlighted:choice.highlighted,labelClass:choice.labelClass,labelDescription:choice.labelDescription,customProperties:choice.customProperties,disabled:choice.disabled,active:choice.active,label:choice.label,placeholder:choice.placeholder,value:choice.value,groupValue:choice.group?choice.group.label:void 0,element:choice.element,keyCode:keyCode}},Choices.prototype._triggerChange=function(value){null!=value&&this.passedElement.triggerEvent(EventType.change,{value:value})},Choices.prototype._handleButtonAction=function(element){var _this=this,items=this._store.items;if(items.length&&this.config.removeItems&&this.config.removeItemButton){var id=element&&parseDataSetId(element.parentElement),itemToRemove=id&&items.find((function(item){return item.id===id}));itemToRemove&&this._store.withTxn((function(){if(_this._removeItem(itemToRemove),_this._triggerChange(itemToRemove.value),_this._isSelectOneElement&&!_this._hasNonChoicePlaceholder){var placeholderChoice=_this._store.choices.reverse().find((function(choice){return!choice.disabled&&choice.placeholder}));placeholderChoice&&(_this._addItem(placeholderChoice),_this.unhighlightAll(),placeholderChoice.value&&_this._triggerChange(placeholderChoice.value))}}))}},Choices.prototype._handleItemAction=function(element,hasShiftKey){var _this=this;void 0===hasShiftKey&&(hasShiftKey=!1);var items=this._store.items;if(items.length&&this.config.removeItems&&!this._isSelectOneElement){var id=parseDataSetId(element);id&&(items.forEach((function(item){item.id!==id||item.highlighted?!hasShiftKey&&item.highlighted&&_this.unhighlightItem(item):_this.highlightItem(item)})),this.input.focus())}},Choices.prototype._handleChoiceAction=function(element){var _this=this,id=parseDataSetId(element),choice=id&&this._store.getChoiceById(id);if(!choice||choice.disabled)return!1;var hasActiveDropdown=this.dropdown.isActive;if(!choice.selected){if(!this._canAddItems())return!0;this._store.withTxn((function(){_this._addItem(choice,!0,!0),_this.clearInput(),_this.unhighlightAll()})),this._triggerChange(choice.value)}return hasActiveDropdown&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},Choices.prototype._handleBackspace=function(items){var config=this.config;if(config.removeItems&&items.length){var lastItem=items[items.length-1],hasHighlightedItems=items.some((function(item){return item.highlighted}));config.editItems&&!hasHighlightedItems&&lastItem?(this.input.value=lastItem.value,this.input.setWidth(),this._removeItem(lastItem),this._triggerChange(lastItem.value)):(hasHighlightedItems||this.highlightItem(lastItem,!1),this.removeHighlightedItems(!0))}},Choices.prototype._loadChoices=function(){var _a,config=this.config;if(this._isTextElement){if(this._presetChoices=config.items.map((function(e){return mapInputToChoice(e,!1)})),this.passedElement.value){var elementItems=this.passedElement.value.split(config.delimiter).map((function(e){return mapInputToChoice(e,!1)}));this._presetChoices=this._presetChoices.concat(elementItems)}this._presetChoices.forEach((function(choice){choice.selected=!0}))}else if(this._isSelectElement){this._presetChoices=config.choices.map((function(e){return mapInputToChoice(e,!0)}));var choicesFromOptions=this.passedElement.optionsAsChoices();choicesFromOptions&&(_a=this._presetChoices).push.apply(_a,choicesFromOptions)}},Choices.prototype._handleLoadingState=function(setLoading){void 0===setLoading&&(setLoading=!0);var el=this.itemList.element;setLoading?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?el.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(el.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},Choices.prototype._handleSearch=function(value){if(this.input.isFocussed)if(null!=value&&value.length>=this.config.searchFloor){var resultCount=this.config.searchChoices?this._searchChoices(value):0;null!==resultCount&&this.passedElement.triggerEvent(EventType.search,{value:value,resultCount:resultCount})}else this._store.choices.some((function(option){return!option.active}))&&this._stopSearch()},Choices.prototype._canAddItems=function(){var config=this.config,maxItemCount=config.maxItemCount,maxItemText=config.maxItemText;return!(!config.singleModeForMultiSelect&&maxItemCount>0&&maxItemCount<=this._store.items.length)||(this.choiceList.element.replaceChildren(""),this._displayNotice("function"==typeof maxItemText?maxItemText(maxItemCount):maxItemText,NoticeTypes.addChoice),!1)},Choices.prototype._canCreateItem=function(value){var config=this.config,canAddItem=!0,notice="";if(canAddItem&&"function"==typeof config.addItemFilter&&!config.addItemFilter(value)&&(canAddItem=!1,notice=resolveNoticeFunction(config.customAddItemText,value)),canAddItem){var foundChoice=this._store.choices.find((function(choice){return config.valueComparer(choice.value,value)}));if(this._isSelectElement){if(foundChoice)return this._displayNotice("",NoticeTypes.addChoice),!1}else this._isTextElement&&!config.duplicateItemsAllowed&&foundChoice&&(canAddItem=!1,notice=resolveNoticeFunction(config.uniqueItemText,value))}return canAddItem&&(notice=resolveNoticeFunction(config.addItemText,value)),notice&&this._displayNotice(notice,NoticeTypes.addChoice),canAddItem},Choices.prototype._searchChoices=function(value){var newValue=value.trim().replace(/\s{2,}/," ");if(!newValue.length||newValue===this._currentValue)return null;var searcher=this._searcher;searcher.isEmptyIndex()&&searcher.index(this._store.searchableChoices);var results=searcher.search(newValue);this._currentValue=newValue,this._highlightPosition=0,this._isSearching=!0;var notice=this._notice;return(notice&&notice.type)!==NoticeTypes.addChoice&&(results.length?this._clearNotice():this._displayNotice(resolveStringFunction(this.config.noResultsText),NoticeTypes.noResults)),this._store.dispatch(filterChoices(results)),results.length},Choices.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(activateChoices(!0)),this.passedElement.triggerEvent(EventType.search,{value:"",resultCount:0}))},Choices.prototype._addEventListeners=function(){var documentElement=this._docRoot,outerElement=this.containerOuter.element,inputElement=this.input.element;documentElement.addEventListener("touchend",this._onTouchEnd,!0),outerElement.addEventListener("keydown",this._onKeyDown,!0),outerElement.addEventListener("mousedown",this._onMouseDown,!0),documentElement.addEventListener("click",this._onClick,{passive:!0}),documentElement.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(outerElement.addEventListener("focus",this._onFocus,{passive:!0}),outerElement.addEventListener("blur",this._onBlur,{passive:!0})),inputElement.addEventListener("keyup",this._onKeyUp,{passive:!0}),inputElement.addEventListener("input",this._onInput,{passive:!0}),inputElement.addEventListener("focus",this._onFocus,{passive:!0}),inputElement.addEventListener("blur",this._onBlur,{passive:!0}),inputElement.form&&inputElement.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},Choices.prototype._removeEventListeners=function(){var documentElement=this._docRoot,outerElement=this.containerOuter.element,inputElement=this.input.element;documentElement.removeEventListener("touchend",this._onTouchEnd,!0),outerElement.removeEventListener("keydown",this._onKeyDown,!0),outerElement.removeEventListener("mousedown",this._onMouseDown,!0),documentElement.removeEventListener("click",this._onClick),documentElement.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(outerElement.removeEventListener("focus",this._onFocus),outerElement.removeEventListener("blur",this._onBlur)),inputElement.removeEventListener("keyup",this._onKeyUp),inputElement.removeEventListener("input",this._onInput),inputElement.removeEventListener("focus",this._onFocus),inputElement.removeEventListener("blur",this._onBlur),inputElement.form&&inputElement.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},Choices.prototype._onKeyDown=function(event){var keyCode=event.keyCode,hasActiveDropdown=this.dropdown.isActive,wasPrintableChar=1===event.key.length||2===event.key.length&&event.key.charCodeAt(0)>=55296||"Unidentified"===event.key;switch(this._isTextElement||hasActiveDropdown||(this.showDropdown(),!this.input.isFocussed&&wasPrintableChar&&(this.input.value+=event.key," "===event.key&&event.preventDefault())),keyCode){case 65:return this._onSelectKey(event,this.itemList.element.hasChildNodes());case 13:return this._onEnterKey(event,hasActiveDropdown);case 27:return this._onEscapeKey(event,hasActiveDropdown);case 38:case 33:case 40:case 34:return this._onDirectionKey(event,hasActiveDropdown);case 8:case 46:return this._onDeleteKey(event,this._store.items,this.input.isFocussed)}},Choices.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},Choices.prototype._onInput=function(){var value=this.input.value;value?this._canAddItems()&&(this._canSearch&&this._handleSearch(value),this._canAddUserChoices&&(this._canCreateItem(value),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice()))):this._isTextElement?this.hideDropdown(!0):this._stopSearch()},Choices.prototype._onSelectKey=function(event,hasItems){(event.ctrlKey||event.metaKey)&&hasItems&&(this._canSearch=!1,this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement&&this.highlightAll())},Choices.prototype._onEnterKey=function(event,hasActiveDropdown){var _this=this,value=this.input.value,target=event.target;if(event.preventDefault(),target&&target.hasAttribute("data-button"))this._handleButtonAction(target);else if(hasActiveDropdown){var highlightedChoice=this.dropdown.element.querySelector(getClassNamesSelector(this.config.classNames.highlightedState));if(!highlightedChoice||!this._handleChoiceAction(highlightedChoice))if(target&&value){if(this._canAddItems()){var addedItem=!1;this._store.withTxn((function(){if(!(addedItem=_this._findAndSelectChoiceByValue(value,!0))){if(!_this._canAddUserChoices)return;if(!_this._canCreateItem(value))return;var sanitisedValue=sanitise(value),userValue=_this.config.allowHtmlUserInput||sanitisedValue===value?value:{escaped:sanitisedValue,raw:value};_this._addChoice(mapInputToChoice({value:userValue,label:userValue,selected:!0},!1),!0,!0),addedItem=!0}_this.clearInput(),_this.unhighlightAll()})),addedItem&&(this._triggerChange(value),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}else this.hideDropdown(!0)}else(this._isSelectElement||this._notice)&&this.showDropdown()},Choices.prototype._onEscapeKey=function(event,hasActiveDropdown){hasActiveDropdown&&(event.stopPropagation(),this.hideDropdown(!0),this.containerOuter.element.focus())},Choices.prototype._onDirectionKey=function(event,hasActiveDropdown){var keyCode=event.keyCode;if(hasActiveDropdown||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var directionInt=40===keyCode||34===keyCode?1:-1,nextEl=void 0;if(event.metaKey||34===keyCode||33===keyCode)nextEl=directionInt>0?this.dropdown.element.querySelector("".concat(selectableChoiceIdentifier,":last-of-type")):this.dropdown.element.querySelector(selectableChoiceIdentifier);else{var currentEl=this.dropdown.element.querySelector(getClassNamesSelector(this.config.classNames.highlightedState));nextEl=currentEl?getAdjacentEl(currentEl,selectableChoiceIdentifier,directionInt):this.dropdown.element.querySelector(selectableChoiceIdentifier)}nextEl&&(isScrolledIntoView(nextEl,this.choiceList.element,directionInt)||this.choiceList.scrollToChildElement(nextEl,directionInt),this._highlightChoice(nextEl)),event.preventDefault()}},Choices.prototype._onDeleteKey=function(event,items,hasFocusedInput){this._isSelectOneElement||event.target.value||!hasFocusedInput||(this._handleBackspace(items),event.preventDefault())},Choices.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},Choices.prototype._onTouchEnd=function(event){var target=(event||event.touches[0]).target;this._wasTap&&this.containerOuter.element.contains(target)&&((target===this.containerOuter.element||target===this.containerInner.element)&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),event.stopPropagation());this._wasTap=!0},Choices.prototype._onMouseDown=function(event){var target=event.target;if(target instanceof HTMLElement){if(IS_IE11&&this.choiceList.element.contains(target)){var firstChoice=this.choiceList.element.firstElementChild;this._isScrollingOnIe="ltr"===this._direction?event.offsetX>=firstChoice.offsetWidth:event.offsetX<firstChoice.offsetLeft}if(target!==this.input.element){var item=target.closest("[data-button],[data-item],[data-choice]");item instanceof HTMLElement&&("button"in item.dataset?this._handleButtonAction(item):"item"in item.dataset?this._handleItemAction(item,event.shiftKey):"choice"in item.dataset&&this._handleChoiceAction(item)),event.preventDefault()}}},Choices.prototype._onMouseOver=function(_a){var target=_a.target;target instanceof HTMLElement&&"choice"in target.dataset&&this._highlightChoice(target)},Choices.prototype._onClick=function(_a){var target=_a.target,containerOuter=this.containerOuter;containerOuter.element.contains(target)?this.dropdown.isActive||containerOuter.isDisabled?this._isSelectOneElement&&target!==this.input.element&&!this.dropdown.element.contains(target)&&this.hideDropdown():this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),containerOuter.element.focus()):(containerOuter.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},Choices.prototype._onFocus=function(_a){var target=_a.target,containerOuter=this.containerOuter;if(target&&containerOuter.element.contains(target)){var targetIsInput=target===this.input.element;this._isTextElement?targetIsInput&&containerOuter.addFocusState():this._isSelectMultipleElement?targetIsInput&&(this.showDropdown(!0),containerOuter.addFocusState()):(containerOuter.addFocusState(),targetIsInput&&this.showDropdown(!0))}},Choices.prototype._onBlur=function(_a){var target=_a.target,containerOuter=this.containerOuter;if(target&&containerOuter.element.contains(target)&&!this._isScrollingOnIe){var targetIsInput=target===this.input.element;this._isTextElement||this._isSelectMultipleElement?targetIsInput&&(containerOuter.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll()):(containerOuter.removeFocusState(),(targetIsInput||target===containerOuter.element&&!this._canSearch)&&this.hideDropdown(!0))}else this._isScrollingOnIe=!1,this.input.element.focus()},Choices.prototype._onFormReset=function(){var _this=this;this._store.withTxn((function(){_this.clearInput(),_this.hideDropdown(),_this.refresh(!1,!1,!0),_this._initialItems.length&&_this.setChoiceByValue(_this._initialItems)}))},Choices.prototype._highlightChoice=function(el){void 0===el&&(el=null);var choices=Array.from(this.dropdown.element.querySelectorAll(selectableChoiceIdentifier));if(choices.length){var passedEl=el,highlightedState=this.config.classNames.highlightedState;Array.from(this.dropdown.element.querySelectorAll(getClassNamesSelector(highlightedState))).forEach((function(choice){removeClassesFromElement(choice,highlightedState),choice.setAttribute("aria-selected","false")})),passedEl?this._highlightPosition=choices.indexOf(passedEl):(passedEl=choices.length>this._highlightPosition?choices[this._highlightPosition]:choices[choices.length-1])||(passedEl=choices[0]),addClassesToElement(passedEl,highlightedState),passedEl.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(EventType.highlightChoice,{el:passedEl}),this.dropdown.isActive&&(this.input.setActiveDescendant(passedEl.id),this.containerOuter.setActiveDescendant(passedEl.id))}},Choices.prototype._addItem=function(item,withEvents,userTriggered){if(void 0===withEvents&&(withEvents=!0),void 0===userTriggered&&(userTriggered=!1),!item.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(item.id),this._store.dispatch(addItem(item)),withEvents&&(this.passedElement.triggerEvent(EventType.addItem,this._getChoiceForOutput(item)),userTriggered&&this.passedElement.triggerEvent(EventType.choice,this._getChoiceForOutput(item)))},Choices.prototype._removeItem=function(item){item.id&&(this._store.dispatch(removeItem$1(item)),this.passedElement.triggerEvent(EventType.removeItem,this._getChoiceForOutput(item)))},Choices.prototype._addChoice=function(choice,withEvents,userTriggered){if(void 0===withEvents&&(withEvents=!0),void 0===userTriggered&&(userTriggered=!1),choice.id)throw new TypeError("Can not re-add a choice which has already been added");var config=this.config;if(!this._isSelectElement&&config.duplicateItemsAllowed||!this._store.choices.find((function(c){return config.valueComparer(c.value,choice.value)}))){this._lastAddedChoiceId++,choice.id=this._lastAddedChoiceId,choice.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(choice.id);var prependValue=config.prependValue,appendValue=config.appendValue;prependValue&&(choice.value=prependValue+choice.value),appendValue&&(choice.value+=appendValue.toString()),(prependValue||appendValue)&&choice.element&&(choice.element.value=choice.value),this._clearNotice(),this._store.dispatch(addChoice(choice)),choice.selected&&this._addItem(choice,withEvents,userTriggered)}},Choices.prototype._addGroup=function(group,withEvents){var _this=this;if(void 0===withEvents&&(withEvents=!0),group.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(addGroup(group)),group.choices&&(this._lastAddedGroupId++,group.id=this._lastAddedGroupId,group.choices.forEach((function(item){item.group=group,group.disabled&&(item.disabled=!0),_this._addChoice(item,withEvents)})))},Choices.prototype._createTemplates=function(){var _this=this,callbackOnCreateTemplates=this.config.callbackOnCreateTemplates,userTemplates={};"function"==typeof callbackOnCreateTemplates&&(userTemplates=callbackOnCreateTemplates.call(this,strToEl,escapeForTemplate,getClassNames));var templating={};Object.keys(this._templates).forEach((function(name){templating[name]=name in userTemplates?userTemplates[name].bind(_this):_this._templates[name].bind(_this)})),this._templates=templating},Choices.prototype._createElements=function(){var templating=this._templates,config=this.config,isSelectOneElement=this._isSelectOneElement,position=config.position,classNames=config.classNames,elementType=this._elementType;this.containerOuter=new Container({element:templating.containerOuter(config,this._direction,this._isSelectElement,isSelectOneElement,config.searchEnabled,elementType,config.labelId),classNames:classNames,type:elementType,position:position}),this.containerInner=new Container({element:templating.containerInner(config),classNames:classNames,type:elementType,position:position}),this.input=new Input({element:templating.input(config,this._placeholderValue),classNames:classNames,type:elementType,preventPaste:!config.paste}),this.choiceList=new List({element:templating.choiceList(config,isSelectOneElement)}),this.itemList=new List({element:templating.itemList(config,isSelectOneElement)}),this.dropdown=new Dropdown({element:templating.dropdown(config),classNames:classNames,type:elementType})},Choices.prototype._createStructure=function(){var containerInner=this.containerInner,containerOuter=this.containerOuter,passedElement=this.passedElement,dropdownElement=this.dropdown.element;passedElement.conceal(),containerInner.wrap(passedElement.element),containerOuter.wrap(containerInner.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),containerOuter.element.appendChild(containerInner.element),containerOuter.element.appendChild(dropdownElement),containerInner.element.appendChild(this.itemList.element),dropdownElement.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&dropdownElement.insertBefore(this.input.element,dropdownElement.firstChild):containerInner.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},Choices.prototype._initStore=function(){var _this=this;this._store.subscribe(this._render).withTxn((function(){_this._addPredefinedChoices(_this._presetChoices,_this._isSelectOneElement&&!_this._hasNonChoicePlaceholder,!1)})),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},Choices.prototype._addPredefinedChoices=function(choices,selectFirstOption,withEvents){var _this=this;(void 0===selectFirstOption&&(selectFirstOption=!1),void 0===withEvents&&(withEvents=!0),selectFirstOption)&&(-1===choices.findIndex((function(choice){return choice.selected}))&&choices.some((function(choice){return!choice.disabled&&!("choices"in choice)&&(choice.selected=!0,!0)})));choices.forEach((function(item){"choices"in item?_this._isSelectElement&&_this._addGroup(item,withEvents):_this._addChoice(item,withEvents)}))},Choices.prototype._findAndSelectChoiceByValue=function(value,userTriggered){var _this=this;void 0===userTriggered&&(userTriggered=!1);var foundChoice=this._store.choices.find((function(choice){return _this.config.valueComparer(choice.value,value)}));return!(!foundChoice||foundChoice.disabled||foundChoice.selected)&&(this._addItem(foundChoice,!0,userTriggered),!0)},Choices.prototype._generatePlaceholderValue=function(){var config=this.config;if(!config.placeholder)return null;if(this._hasNonChoicePlaceholder)return config.placeholderValue;if(this._isSelectElement){var placeholderOption=this.passedElement.placeholderOption;return placeholderOption?placeholderOption.text:null}return null},Choices.prototype._warnChoicesInitFailed=function(caller){if(!this.config.silent){if(!this.initialised)throw new TypeError("".concat(caller," called on a non-initialised instance of Choices"));if(!this.initialisedOK)throw new TypeError("".concat(caller," called for an element which has multiple instances of Choices initialised on it"))}},Choices.version="11.0.2",Choices}();export{Choices as default};